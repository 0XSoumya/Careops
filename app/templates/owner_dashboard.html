{% extends "base.html" %}

{% block page_title %}Owner Dashboard{% endblock %}

{% block content %}

<div class="dashboard-grid">

    <div class="stat-card">
        <h4>Total Leads</h4>
        <div class="stat-number">{{ total_leads }}</div>
    </div>

    <div class="stat-card">
        <h4>Active Conversations</h4>
        <div class="stat-number">{{ active_conversations }}</div>
    </div>

    <div class="stat-card">
        <h4>Pending Bookings</h4>
        <div class="stat-number">{{ pending_bookings }}</div>
    </div>

    <div class="stat-card">
        <h4>Confirmed Bookings</h4>
        <div class="stat-number">{{ confirmed_bookings }}</div>
    </div>

    <div class="stat-card">
        <h4>Completed Bookings</h4>
        <div class="stat-number">{{ completed_bookings }}</div>
    </div>

    <div class="stat-card {% if low_stock > 0 %}alert-card{% endif %}">
        <h4>Low Stock Alerts</h4>
        <div class="stat-number">{{ low_stock }}</div>
    </div>

</div>


{% if low_stock > 0 %}
<a href="/owner/inventory" class="alert-card-clickable">
    <div class="alert-card-inner">
        <div>
            <strong>⚠ Inventory Alert</strong>
            <p>{{ low_stock }} items below threshold.</p>
        </div>
        <div>→ Review</div>
    </div>
</a>
{% endif %}


<div class="charts-grid">

    <div class="card">
        <h3>Inventory Health</h3>
        <div class="chart-small">
            <canvas id="inventoryChart"></canvas>
        </div>
    </div>

    <div class="card">
        <h3>Booking Status</h3>
        <canvas id="bookingChart"></canvas>
    </div>

</div>

{% endblock %}


{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
new Chart(document.getElementById('inventoryChart'), {
    type: 'doughnut',
    data: {
        labels: ['Low Stock', 'Healthy'],
        datasets: [{
            data: [{{ low_stock }}, {{ healthy_stock }}],
            backgroundColor: ['#ef4444', '#22c55e'],
            borderWidth: 0
        }]
    },
    options: {
        cutout: '70%',
        plugins: { legend: { position: 'bottom' } }
    }
});

new Chart(document.getElementById('bookingChart'), {
    type: 'bar',
    data: {
        labels: ['Pending', 'Confirmed', 'Completed'],
        datasets: [{
            data: [
                {{ pending_bookings }},
                {{ confirmed_bookings }},
                {{ completed_bookings }}
            ],
            backgroundColor: ['#f59e0b', '#3b82f6', '#22c55e']
        }]
    },
    options: {
        plugins: { legend: { display: false } }
    }
});
</script>
{% endblock %}
